24/05/2024 8:36:06 - gbenavides - delete from ff_facturas_all where factoring = 202402
24/05/2024 8:36:12 - gbenavides - delete from ff_estimacion where factoring = 202402
24/05/2024 8:36:14 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202402 and bloque = 0
24/05/2024 8:36:20 - gbenavides - select null as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2023-02-01' and f.fh_fin_fact <= '2023-02-28' and f.fh_fact >='2023-03-01' and f.fh_fact <= '2023-03-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 8:37:07 - gbenavides - select null as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, null as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact is null and f.fh_fin_fact is null and f.fh_fact >='2023-03-01' and f.fh_fact <= '2023-03-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S' group by ccounips,cemptitu,creferen,secfactu,cfactura,ffactura,ffactdes,ffacthas,ifactura,iva,iimpues2,iimpues3,ibaseise,ise,tfactura,testfact,dapersoc,cnifdnic,indempre,cupsree,cfactrec,clinneg,csegmerc,numlabor,tiponegocio
24/05/2024 8:37:59 - gbenavides - replace into ff_facturas_all_tmp select 202402, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2023-02-01' and FFACTHAS <= '2023-02-28') AND (FFACTURA >= '2023-03-01' and FFACTURA <= '2023-03-31') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 8:39:12 - gbenavides - replace into ff_facturas_all_tmp select 202402, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2023-03-01' and FFACTURA <= '2023-03-31') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 8:39:38 - gbenavides - replace into ff_facturas_all_tmp select  202402, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2023-02-01' and f.FFACTURA <= '2023-02-28') and (f.FFACTDES >= '2023-02-01' and f.FFACTHAS <= '2023-02-28') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 8:40:01 - gbenavides - replace into ff_facturas_all_tmp select 202402, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2023-02-01' and FFACTHAS <= '2023-02-28') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 8:42:48 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 8:42:52 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202402 and bloque = 0
24/05/2024 9:19:58 - gbenavides - delete from ff_facturas_all where factoring = 202402
24/05/2024 9:20:03 - gbenavides - delete from ff_estimacion where factoring = 202402
24/05/2024 9:20:04 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202402 and bloque = 0
24/05/2024 9:20:10 - gbenavides - select null as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2023-02-01' and f.fh_fin_fact <= '2023-02-28' and f.fh_fact >='2023-03-01' and f.fh_fact <= '2023-03-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 9:20:17 - gbenavides - select null as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, null as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact is null and f.fh_fin_fact is null and f.fh_fact >='2023-03-01' and f.fh_fact <= '2023-03-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S' group by ccounips,cemptitu,creferen,secfactu,cfactura,ffactura,ffactdes,ffacthas,ifactura,iva,iimpues2,iimpues3,ibaseise,ise,tfactura,testfact,dapersoc,cnifdnic,indempre,cupsree,cfactrec,clinneg,csegmerc,numlabor,tiponegocio
24/05/2024 9:20:19 - gbenavides - replace into ff_facturas_all_tmp select 202402, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2023-02-01' and FFACTHAS <= '2023-02-28') AND (FFACTURA >= '2023-03-01' and FFACTURA <= '2023-03-31') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 9:21:34 - gbenavides - replace into ff_facturas_all_tmp select 202402, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2023-03-01' and FFACTURA <= '2023-03-31') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 9:22:11 - gbenavides - replace into ff_facturas_all_tmp select  202402, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2023-02-01' and f.FFACTURA <= '2023-02-28') and (f.FFACTDES >= '2023-02-01' and f.FFACTHAS <= '2023-02-28') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 9:22:33 - gbenavides - replace into ff_facturas_all_tmp select 202402, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2023-02-01' and FFACTHAS <= '2023-02-28') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 9:25:08 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 9:25:11 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202402 and bloque = 0
24/05/2024 9:25:13 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 20 and INDEMPRE = 'CEFACO' and factoring = 202402 and bloque = 0
24/05/2024 9:25:15 - gbenavides - delete from ff_facturas_all_tmp where ffacthas < '2023-02-01' and factoring = 202402 and bloque = 0
24/05/2024 9:25:17 - gbenavides - update ff_facturas_all_tmp f left outer join fo_s s on s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU left outer join cm_inventario_gas i on i.ID_PS = s.ID_PS and (i.FINICIO <= f.FFACTDES and (i.FFIN >= f.FFACTHAS or i.FFIN is null)) and i.Grupo = 'Cisterna' set f.CUPSREE = concat('Cisterna_', i.ID_PS), f.CCOUNIPS = concat('Cisterna_', i.ID_PS) where f.factoring = 202402 and f.bloque = 0 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 9:25:59 - gbenavides - update ff_facturas_all_tmp f left outer join fo s on s.CEMPTITU = f.CEMPTITU and s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU set f.CUPSREE = s.CUPSREE, f.CCOUNIPS = s.CCOUNIPS where f.factoring = 202402 and f.bloque = 0 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 9:26:00 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202402 and bloque = 0 and TESTFACT = 'A';
24/05/2024 9:26:01 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202402 and bloque = 0 and TESTFACT = 'S';
24/05/2024 9:26:03 - gbenavides - delete from ff_facturas_pp_tmp;
24/05/2024 9:26:04 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTHAS < '2023-02-28' and f.factoring = 202402 and f.bloque = 0
24/05/2024 9:26:05 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTDES > '2023-02-01' and f.factoring = 202402 and f.bloque = 0
24/05/2024 9:26:10 - gbenavides - replace into ff_facturas_all_tmp_eliminadas select f.*, 'Importe inferior a 5000' from ff_facturas_all_tmp f where f.IFACTURA < 5000 and f.factoring = 202402 and f.bloque = 0
24/05/2024 9:26:22 - gbenavides - delete from ff_facturas_all_tmp where IFACTURA < 5000 and factoring = 202402 and bloque = 0
24/05/2024 9:26:26 - gbenavides - delete from ff_nif_tmp;
24/05/2024 9:26:26 - gbenavides - replace into ff_nif_tmp select f.CNIFDNIC, f.TIPONEGOCIO, sum(f.IFACTURA) as total from ff_facturas_all_tmp f where f.factoring = 202402 and f.bloque = 0 group by f.CNIFDNIC < 20000
24/05/2024 9:26:28 - gbenavides - delete f from ff_facturas_all_tmp f inner join ff_nif_tmp r on r.CNIFDNIC = f.CNIFDNIC where f.factoring = 202402 and f.bloque = 0
24/05/2024 9:26:49 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202402 and bloque = 1
24/05/2024 9:26:52 - gbenavides - select null as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2023-10-01' and f.fh_fin_fact <= '2023-10-31' and f.fh_fact >='2023-11-01' and f.fh_fact <= '2023-11-30' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 9:27:02 - gbenavides - select null as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, null as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact is null and f.fh_fin_fact is null and f.fh_fact >='2023-11-01' and f.fh_fact <= '2023-11-30' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S' group by ccounips,cemptitu,creferen,secfactu,cfactura,ffactura,ffactdes,ffacthas,ifactura,iva,iimpues2,iimpues3,ibaseise,ise,tfactura,testfact,dapersoc,cnifdnic,indempre,cupsree,cfactrec,clinneg,csegmerc,numlabor,tiponegocio
24/05/2024 9:27:04 - gbenavides - replace into ff_facturas_all_tmp select 202402, 1, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2023-10-01' and FFACTHAS <= '2023-10-31') AND (FFACTURA >= '2023-11-01' and FFACTURA <= '2023-11-30') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 9:28:18 - gbenavides - replace into ff_facturas_all_tmp select 202402, 1, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2023-11-01' and FFACTURA <= '2023-11-30') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 9:29:06 - gbenavides - replace into ff_facturas_all_tmp select  202402, 1, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2023-10-01' and f.FFACTURA <= '2023-10-31') and (f.FFACTDES >= '2023-10-01' and f.FFACTHAS <= '2023-10-31') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 9:29:31 - gbenavides - replace into ff_facturas_all_tmp select 202402, 1, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2023-10-01' and FFACTHAS <= '2023-10-31') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 9:32:26 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 9:32:31 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202402 and bloque = 1
24/05/2024 9:32:33 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 20 and INDEMPRE = 'CEFACO' and factoring = 202402 and bloque = 1
24/05/2024 9:32:35 - gbenavides - delete from ff_facturas_all_tmp where ffacthas < '2023-10-01' and factoring = 202402 and bloque = 1
24/05/2024 9:32:37 - gbenavides - update ff_facturas_all_tmp f left outer join fo_s s on s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU left outer join cm_inventario_gas i on i.ID_PS = s.ID_PS and (i.FINICIO <= f.FFACTDES and (i.FFIN >= f.FFACTHAS or i.FFIN is null)) and i.Grupo = 'Cisterna' set f.CUPSREE = concat('Cisterna_', i.ID_PS), f.CCOUNIPS = concat('Cisterna_', i.ID_PS) where f.factoring = 202402 and f.bloque = 1 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 9:33:23 - gbenavides - update ff_facturas_all_tmp f left outer join fo s on s.CEMPTITU = f.CEMPTITU and s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU set f.CUPSREE = s.CUPSREE, f.CCOUNIPS = s.CCOUNIPS where f.factoring = 202402 and f.bloque = 1 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 9:33:24 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202402 and bloque = 1 and TESTFACT = 'A';
24/05/2024 9:33:25 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202402 and bloque = 1 and TESTFACT = 'S';
24/05/2024 9:33:27 - gbenavides - delete from ff_facturas_pp_tmp;
24/05/2024 9:33:28 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTHAS < '2023-10-31' and f.factoring = 202402 and f.bloque = 1
24/05/2024 9:33:29 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTDES > '2023-10-01' and f.factoring = 202402 and f.bloque = 1
24/05/2024 9:33:33 - gbenavides - replace into ff_facturas_all_tmp_eliminadas select f.*, 'Importe inferior a 5000' from ff_facturas_all_tmp f where f.IFACTURA < 5000 and f.factoring = 202402 and f.bloque = 1
24/05/2024 9:33:41 - gbenavides - delete from ff_facturas_all_tmp where IFACTURA < 5000 and factoring = 202402 and bloque = 1
24/05/2024 9:33:45 - gbenavides - delete from ff_nif_tmp;
24/05/2024 9:33:46 - gbenavides - replace into ff_nif_tmp select f.CNIFDNIC, f.TIPONEGOCIO, sum(f.IFACTURA) as total from ff_facturas_all_tmp f where f.factoring = 202402 and f.bloque = 1 group by f.CNIFDNIC < 20000
24/05/2024 9:33:47 - gbenavides - delete f from ff_facturas_all_tmp f inner join ff_nif_tmp r on r.CNIFDNIC = f.CNIFDNIC where f.factoring = 202402 and f.bloque = 1
24/05/2024 9:34:05 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202402 and bloque = 2
24/05/2024 9:34:06 - gbenavides - select null as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2023-11-01' and f.fh_fin_fact <= '2023-11-30' and f.fh_fact >='2023-12-01' and f.fh_fact <= '2023-12-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 9:34:16 - gbenavides - select null as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, null as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact is null and f.fh_fin_fact is null and f.fh_fact >='2023-12-01' and f.fh_fact <= '2023-12-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S' group by ccounips,cemptitu,creferen,secfactu,cfactura,ffactura,ffactdes,ffacthas,ifactura,iva,iimpues2,iimpues3,ibaseise,ise,tfactura,testfact,dapersoc,cnifdnic,indempre,cupsree,cfactrec,clinneg,csegmerc,numlabor,tiponegocio
24/05/2024 9:34:18 - gbenavides - replace into ff_facturas_all_tmp select 202402, 2, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2023-11-01' and FFACTHAS <= '2023-11-30') AND (FFACTURA >= '2023-12-01' and FFACTURA <= '2023-12-31') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 9:35:04 - gbenavides - replace into ff_facturas_all_tmp select 202402, 2, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2023-12-01' and FFACTURA <= '2023-12-31') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 9:35:10 - gbenavides - replace into ff_facturas_all_tmp select  202402, 2, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2023-11-01' and f.FFACTURA <= '2023-11-30') and (f.FFACTDES >= '2023-11-01' and f.FFACTHAS <= '2023-11-30') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 9:35:25 - gbenavides - replace into ff_facturas_all_tmp select 202402, 2, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2023-11-01' and FFACTHAS <= '2023-11-30') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 9:39:12 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 9:39:17 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202402 and bloque = 2
24/05/2024 9:39:19 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 20 and INDEMPRE = 'CEFACO' and factoring = 202402 and bloque = 2
24/05/2024 9:39:21 - gbenavides - delete from ff_facturas_all_tmp where ffacthas < '2023-11-01' and factoring = 202402 and bloque = 2
24/05/2024 9:39:22 - gbenavides - update ff_facturas_all_tmp f left outer join fo_s s on s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU left outer join cm_inventario_gas i on i.ID_PS = s.ID_PS and (i.FINICIO <= f.FFACTDES and (i.FFIN >= f.FFACTHAS or i.FFIN is null)) and i.Grupo = 'Cisterna' set f.CUPSREE = concat('Cisterna_', i.ID_PS), f.CCOUNIPS = concat('Cisterna_', i.ID_PS) where f.factoring = 202402 and f.bloque = 2 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 9:39:26 - gbenavides - update ff_facturas_all_tmp f left outer join fo s on s.CEMPTITU = f.CEMPTITU and s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU set f.CUPSREE = s.CUPSREE, f.CCOUNIPS = s.CCOUNIPS where f.factoring = 202402 and f.bloque = 2 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 9:39:27 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202402 and bloque = 2 and TESTFACT = 'A';
24/05/2024 9:39:28 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202402 and bloque = 2 and TESTFACT = 'S';
24/05/2024 9:39:31 - gbenavides - delete from ff_facturas_pp_tmp;
24/05/2024 9:39:32 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTHAS < '2023-11-30' and f.factoring = 202402 and f.bloque = 2
24/05/2024 9:39:33 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTDES > '2023-11-01' and f.factoring = 202402 and f.bloque = 2
24/05/2024 9:39:36 - gbenavides - replace into ff_facturas_all_tmp_eliminadas select f.*, 'Importe inferior a 5000' from ff_facturas_all_tmp f where f.IFACTURA < 5000 and f.factoring = 202402 and f.bloque = 2
24/05/2024 9:39:46 - gbenavides - delete from ff_facturas_all_tmp where IFACTURA < 5000 and factoring = 202402 and bloque = 2
24/05/2024 9:39:49 - gbenavides - delete from ff_nif_tmp;
24/05/2024 9:39:49 - gbenavides - replace into ff_nif_tmp select f.CNIFDNIC, f.TIPONEGOCIO, sum(f.IFACTURA) as total from ff_facturas_all_tmp f where f.factoring = 202402 and f.bloque = 2 group by f.CNIFDNIC < 20000
24/05/2024 9:39:50 - gbenavides - delete f from ff_facturas_all_tmp f inner join ff_nif_tmp r on r.CNIFDNIC = f.CNIFDNIC where f.factoring = 202402 and f.bloque = 2
24/05/2024 9:39:58 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202402 and bloque = 3
24/05/2024 9:39:59 - gbenavides - select null as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2023-12-01' and f.fh_fin_fact <= '2023-12-31' and f.fh_fact >='2024-01-01' and f.fh_fact <= '2024-01-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 9:40:07 - gbenavides - select null as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, null as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact is null and f.fh_fin_fact is null and f.fh_fact >='2024-01-01' and f.fh_fact <= '2024-01-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S' group by ccounips,cemptitu,creferen,secfactu,cfactura,ffactura,ffactdes,ffacthas,ifactura,iva,iimpues2,iimpues3,ibaseise,ise,tfactura,testfact,dapersoc,cnifdnic,indempre,cupsree,cfactrec,clinneg,csegmerc,numlabor,tiponegocio
24/05/2024 9:40:08 - gbenavides - replace into ff_facturas_all_tmp select 202402, 3, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2023-12-01' and FFACTHAS <= '2023-12-31') AND (FFACTURA >= '2024-01-01' and FFACTURA <= '2024-01-31') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 9:40:37 - gbenavides - replace into ff_facturas_all_tmp select 202402, 3, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2024-01-01' and FFACTURA <= '2024-01-31') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 9:40:41 - gbenavides - replace into ff_facturas_all_tmp select  202402, 3, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2023-12-01' and f.FFACTURA <= '2023-12-31') and (f.FFACTDES >= '2023-12-01' and f.FFACTHAS <= '2023-12-31') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 9:40:48 - gbenavides - replace into ff_facturas_all_tmp select 202402, 3, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2023-12-01' and FFACTHAS <= '2023-12-31') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 9:40:50 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 9:40:53 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202402 and bloque = 3
24/05/2024 9:40:53 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 20 and INDEMPRE = 'CEFACO' and factoring = 202402 and bloque = 3
24/05/2024 9:40:55 - gbenavides - delete from ff_facturas_all_tmp where ffacthas < '2023-12-01' and factoring = 202402 and bloque = 3
24/05/2024 9:40:56 - gbenavides - update ff_facturas_all_tmp f left outer join fo_s s on s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU left outer join cm_inventario_gas i on i.ID_PS = s.ID_PS and (i.FINICIO <= f.FFACTDES and (i.FFIN >= f.FFACTHAS or i.FFIN is null)) and i.Grupo = 'Cisterna' set f.CUPSREE = concat('Cisterna_', i.ID_PS), f.CCOUNIPS = concat('Cisterna_', i.ID_PS) where f.factoring = 202402 and f.bloque = 3 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 9:41:00 - gbenavides - update ff_facturas_all_tmp f left outer join fo s on s.CEMPTITU = f.CEMPTITU and s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU set f.CUPSREE = s.CUPSREE, f.CCOUNIPS = s.CCOUNIPS where f.factoring = 202402 and f.bloque = 3 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 9:41:00 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202402 and bloque = 3 and TESTFACT = 'A';
24/05/2024 9:41:01 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202402 and bloque = 3 and TESTFACT = 'S';
24/05/2024 9:41:02 - gbenavides - delete from ff_facturas_pp_tmp;
24/05/2024 9:41:03 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTHAS < '2023-12-31' and f.factoring = 202402 and f.bloque = 3
24/05/2024 9:41:04 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTDES > '2023-12-01' and f.factoring = 202402 and f.bloque = 3
24/05/2024 9:41:06 - gbenavides - replace into ff_facturas_all_tmp_eliminadas select f.*, 'Importe inferior a 5000' from ff_facturas_all_tmp f where f.IFACTURA < 5000 and f.factoring = 202402 and f.bloque = 3
24/05/2024 9:41:08 - gbenavides - delete from ff_facturas_all_tmp where IFACTURA < 5000 and factoring = 202402 and bloque = 3
24/05/2024 9:41:10 - gbenavides - delete from ff_nif_tmp;
24/05/2024 9:41:11 - gbenavides - replace into ff_nif_tmp select f.CNIFDNIC, f.TIPONEGOCIO, sum(f.IFACTURA) as total from ff_facturas_all_tmp f where f.factoring = 202402 and f.bloque = 3 group by f.CNIFDNIC < 20000
24/05/2024 9:41:12 - gbenavides - delete f from ff_facturas_all_tmp f inner join ff_nif_tmp r on r.CNIFDNIC = f.CNIFDNIC where f.factoring = 202402 and f.bloque = 3
24/05/2024 9:54:31 - gbenavides - delete from ff_facturas_all where factoring = 202402
24/05/2024 9:54:34 - gbenavides - delete from ff_estimacion where factoring = 202402
24/05/2024 9:54:35 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202402 and bloque = 0
24/05/2024 9:54:40 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2023-02-01' and f.fh_fin_fact <= '2023-02-28' and f.fh_fact >='2023-03-01' and f.fh_fact <= '2023-03-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 9:55:43 - gbenavides - replace into ff_facturas_all_tmp select 202402, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2023-02-01' and FFACTHAS <= '2023-02-28') AND (FFACTURA >= '2023-03-01' and FFACTURA <= '2023-03-31') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 9:57:05 - gbenavides - replace into ff_facturas_all_tmp select 202402, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2023-03-01' and FFACTURA <= '2023-03-31') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 9:57:49 - gbenavides - replace into ff_facturas_all_tmp select  202402, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2023-02-01' and f.FFACTURA <= '2023-02-28') and (f.FFACTDES >= '2023-02-01' and f.FFACTHAS <= '2023-02-28') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 9:58:19 - gbenavides - replace into ff_facturas_all_tmp select 202402, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2023-02-01' and FFACTHAS <= '2023-02-28') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 10:01:31 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 10:01:34 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202402 and bloque = 0
24/05/2024 10:01:36 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 20 and INDEMPRE = 'CEFACO' and factoring = 202402 and bloque = 0
24/05/2024 10:01:38 - gbenavides - delete from ff_facturas_all_tmp where ffacthas < '2023-02-01' and factoring = 202402 and bloque = 0
24/05/2024 10:01:39 - gbenavides - update ff_facturas_all_tmp f left outer join fo_s s on s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU left outer join cm_inventario_gas i on i.ID_PS = s.ID_PS and (i.FINICIO <= f.FFACTDES and (i.FFIN >= f.FFACTHAS or i.FFIN is null)) and i.Grupo = 'Cisterna' set f.CUPSREE = concat('Cisterna_', i.ID_PS), f.CCOUNIPS = concat('Cisterna_', i.ID_PS) where f.factoring = 202402 and f.bloque = 0 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 10:02:50 - gbenavides - update ff_facturas_all_tmp f left outer join fo s on s.CEMPTITU = f.CEMPTITU and s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU set f.CUPSREE = s.CUPSREE, f.CCOUNIPS = s.CCOUNIPS where f.factoring = 202402 and f.bloque = 0 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 10:02:51 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202402 and bloque = 0 and TESTFACT = 'A';
24/05/2024 10:02:52 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202402 and bloque = 0 and TESTFACT = 'S';
24/05/2024 10:02:56 - gbenavides - delete from ff_facturas_pp_tmp;
24/05/2024 10:02:56 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTHAS < '2023-02-28' and f.factoring = 202402 and f.bloque = 0
24/05/2024 10:02:59 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTDES > '2023-02-01' and f.factoring = 202402 and f.bloque = 0
24/05/2024 10:03:07 - gbenavides - replace into ff_facturas_all_tmp_eliminadas select f.*, 'Importe inferior a 5000' from ff_facturas_all_tmp f where f.IFACTURA < 5000 and f.factoring = 202402 and f.bloque = 0
24/05/2024 10:03:20 - gbenavides - delete from ff_facturas_all_tmp where IFACTURA < 5000 and factoring = 202402 and bloque = 0
24/05/2024 10:03:26 - gbenavides - delete from ff_nif_tmp;
24/05/2024 10:03:26 - gbenavides - replace into ff_nif_tmp select f.CNIFDNIC, f.TIPONEGOCIO, sum(f.IFACTURA) as total from ff_facturas_all_tmp f where f.factoring = 202402 and f.bloque = 0 group by f.CNIFDNIC < 20000
24/05/2024 10:03:28 - gbenavides - delete f from ff_facturas_all_tmp f inner join ff_nif_tmp r on r.CNIFDNIC = f.CNIFDNIC where f.factoring = 202402 and f.bloque = 0
24/05/2024 10:03:54 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202402 and bloque = 1
24/05/2024 10:03:58 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2023-10-01' and f.fh_fin_fact <= '2023-10-31' and f.fh_fact >='2023-11-01' and f.fh_fact <= '2023-11-30' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 10:05:34 - gbenavides - replace into ff_facturas_all_tmp select 202402, 1, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2023-10-01' and FFACTHAS <= '2023-10-31') AND (FFACTURA >= '2023-11-01' and FFACTURA <= '2023-11-30') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 10:06:57 - gbenavides - replace into ff_facturas_all_tmp select 202402, 1, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2023-11-01' and FFACTURA <= '2023-11-30') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 10:07:42 - gbenavides - replace into ff_facturas_all_tmp select  202402, 1, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2023-10-01' and f.FFACTURA <= '2023-10-31') and (f.FFACTDES >= '2023-10-01' and f.FFACTHAS <= '2023-10-31') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 10:08:11 - gbenavides - replace into ff_facturas_all_tmp select 202402, 1, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2023-10-01' and FFACTHAS <= '2023-10-31') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 10:11:18 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 10:11:23 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202402 and bloque = 1
24/05/2024 10:11:24 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 20 and INDEMPRE = 'CEFACO' and factoring = 202402 and bloque = 1
24/05/2024 10:11:26 - gbenavides - delete from ff_facturas_all_tmp where ffacthas < '2023-10-01' and factoring = 202402 and bloque = 1
24/05/2024 10:11:28 - gbenavides - update ff_facturas_all_tmp f left outer join fo_s s on s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU left outer join cm_inventario_gas i on i.ID_PS = s.ID_PS and (i.FINICIO <= f.FFACTDES and (i.FFIN >= f.FFACTHAS or i.FFIN is null)) and i.Grupo = 'Cisterna' set f.CUPSREE = concat('Cisterna_', i.ID_PS), f.CCOUNIPS = concat('Cisterna_', i.ID_PS) where f.factoring = 202402 and f.bloque = 1 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 10:12:11 - gbenavides - update ff_facturas_all_tmp f left outer join fo s on s.CEMPTITU = f.CEMPTITU and s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU set f.CUPSREE = s.CUPSREE, f.CCOUNIPS = s.CCOUNIPS where f.factoring = 202402 and f.bloque = 1 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 10:12:12 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202402 and bloque = 1 and TESTFACT = 'A';
24/05/2024 10:12:13 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202402 and bloque = 1 and TESTFACT = 'S';
24/05/2024 10:12:16 - gbenavides - delete from ff_facturas_pp_tmp;
24/05/2024 10:12:17 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTHAS < '2023-10-31' and f.factoring = 202402 and f.bloque = 1
24/05/2024 10:12:18 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTDES > '2023-10-01' and f.factoring = 202402 and f.bloque = 1
24/05/2024 10:12:23 - gbenavides - replace into ff_facturas_all_tmp_eliminadas select f.*, 'Importe inferior a 5000' from ff_facturas_all_tmp f where f.IFACTURA < 5000 and f.factoring = 202402 and f.bloque = 1
24/05/2024 10:12:31 - gbenavides - delete from ff_facturas_all_tmp where IFACTURA < 5000 and factoring = 202402 and bloque = 1
24/05/2024 10:12:35 - gbenavides - delete from ff_nif_tmp;
24/05/2024 10:12:36 - gbenavides - replace into ff_nif_tmp select f.CNIFDNIC, f.TIPONEGOCIO, sum(f.IFACTURA) as total from ff_facturas_all_tmp f where f.factoring = 202402 and f.bloque = 1 group by f.CNIFDNIC < 20000
24/05/2024 10:12:37 - gbenavides - delete f from ff_facturas_all_tmp f inner join ff_nif_tmp r on r.CNIFDNIC = f.CNIFDNIC where f.factoring = 202402 and f.bloque = 1
24/05/2024 10:12:55 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202402 and bloque = 2
24/05/2024 10:12:56 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2023-11-01' and f.fh_fin_fact <= '2023-11-30' and f.fh_fact >='2023-12-01' and f.fh_fact <= '2023-12-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 10:24:32 - gbenavides - replace into ff_facturas_all_tmp select 202402, 2, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2023-11-01' and FFACTHAS <= '2023-11-30') AND (FFACTURA >= '2023-12-01' and FFACTURA <= '2023-12-31') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 10:25:22 - gbenavides - replace into ff_facturas_all_tmp select 202402, 2, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2023-12-01' and FFACTURA <= '2023-12-31') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 10:25:27 - gbenavides - replace into ff_facturas_all_tmp select  202402, 2, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2023-11-01' and f.FFACTURA <= '2023-11-30') and (f.FFACTDES >= '2023-11-01' and f.FFACTHAS <= '2023-11-30') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 10:25:37 - gbenavides - replace into ff_facturas_all_tmp select 202402, 2, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2023-11-01' and FFACTHAS <= '2023-11-30') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 10:28:55 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 10:28:59 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202402 and bloque = 2
24/05/2024 10:29:00 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 20 and INDEMPRE = 'CEFACO' and factoring = 202402 and bloque = 2
24/05/2024 10:29:02 - gbenavides - delete from ff_facturas_all_tmp where ffacthas < '2023-11-01' and factoring = 202402 and bloque = 2
24/05/2024 10:29:03 - gbenavides - update ff_facturas_all_tmp f left outer join fo_s s on s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU left outer join cm_inventario_gas i on i.ID_PS = s.ID_PS and (i.FINICIO <= f.FFACTDES and (i.FFIN >= f.FFACTHAS or i.FFIN is null)) and i.Grupo = 'Cisterna' set f.CUPSREE = concat('Cisterna_', i.ID_PS), f.CCOUNIPS = concat('Cisterna_', i.ID_PS) where f.factoring = 202402 and f.bloque = 2 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 10:29:06 - gbenavides - update ff_facturas_all_tmp f left outer join fo s on s.CEMPTITU = f.CEMPTITU and s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU set f.CUPSREE = s.CUPSREE, f.CCOUNIPS = s.CCOUNIPS where f.factoring = 202402 and f.bloque = 2 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 10:29:07 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202402 and bloque = 2 and TESTFACT = 'A';
24/05/2024 10:29:08 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202402 and bloque = 2 and TESTFACT = 'S';
24/05/2024 10:29:11 - gbenavides - delete from ff_facturas_pp_tmp;
24/05/2024 10:29:12 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTHAS < '2023-11-30' and f.factoring = 202402 and f.bloque = 2
24/05/2024 10:29:13 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTDES > '2023-11-01' and f.factoring = 202402 and f.bloque = 2
24/05/2024 10:29:17 - gbenavides - replace into ff_facturas_all_tmp_eliminadas select f.*, 'Importe inferior a 5000' from ff_facturas_all_tmp f where f.IFACTURA < 5000 and f.factoring = 202402 and f.bloque = 2
24/05/2024 10:29:26 - gbenavides - delete from ff_facturas_all_tmp where IFACTURA < 5000 and factoring = 202402 and bloque = 2
24/05/2024 10:29:28 - gbenavides - delete from ff_nif_tmp;
24/05/2024 10:29:29 - gbenavides - replace into ff_nif_tmp select f.CNIFDNIC, f.TIPONEGOCIO, sum(f.IFACTURA) as total from ff_facturas_all_tmp f where f.factoring = 202402 and f.bloque = 2 group by f.CNIFDNIC < 20000
24/05/2024 10:29:30 - gbenavides - delete f from ff_facturas_all_tmp f inner join ff_nif_tmp r on r.CNIFDNIC = f.CNIFDNIC where f.factoring = 202402 and f.bloque = 2
24/05/2024 10:29:38 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202402 and bloque = 3
24/05/2024 10:29:39 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2023-12-01' and f.fh_fin_fact <= '2023-12-31' and f.fh_fact >='2024-01-01' and f.fh_fact <= '2024-01-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 10:36:43 - gbenavides - replace into ff_facturas_all_tmp select 202402, 3, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2023-12-01' and FFACTHAS <= '2023-12-31') AND (FFACTURA >= '2024-01-01' and FFACTURA <= '2024-01-31') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 10:37:09 - gbenavides - replace into ff_facturas_all_tmp select 202402, 3, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2024-01-01' and FFACTURA <= '2024-01-31') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 10:37:12 - gbenavides - replace into ff_facturas_all_tmp select  202402, 3, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2023-12-01' and f.FFACTURA <= '2023-12-31') and (f.FFACTDES >= '2023-12-01' and f.FFACTHAS <= '2023-12-31') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 10:37:19 - gbenavides - replace into ff_facturas_all_tmp select 202402, 3, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2023-12-01' and FFACTHAS <= '2023-12-31') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 10:37:21 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 10:37:23 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202402 and bloque = 3
24/05/2024 10:37:24 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 20 and INDEMPRE = 'CEFACO' and factoring = 202402 and bloque = 3
24/05/2024 10:37:25 - gbenavides - delete from ff_facturas_all_tmp where ffacthas < '2023-12-01' and factoring = 202402 and bloque = 3
24/05/2024 10:37:26 - gbenavides - update ff_facturas_all_tmp f left outer join fo_s s on s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU left outer join cm_inventario_gas i on i.ID_PS = s.ID_PS and (i.FINICIO <= f.FFACTDES and (i.FFIN >= f.FFACTHAS or i.FFIN is null)) and i.Grupo = 'Cisterna' set f.CUPSREE = concat('Cisterna_', i.ID_PS), f.CCOUNIPS = concat('Cisterna_', i.ID_PS) where f.factoring = 202402 and f.bloque = 3 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 10:37:31 - gbenavides - update ff_facturas_all_tmp f left outer join fo s on s.CEMPTITU = f.CEMPTITU and s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU set f.CUPSREE = s.CUPSREE, f.CCOUNIPS = s.CCOUNIPS where f.factoring = 202402 and f.bloque = 3 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 10:37:32 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202402 and bloque = 3 and TESTFACT = 'A';
24/05/2024 10:37:33 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202402 and bloque = 3 and TESTFACT = 'S';
24/05/2024 10:37:34 - gbenavides - delete from ff_facturas_pp_tmp;
24/05/2024 10:37:35 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTHAS < '2023-12-31' and f.factoring = 202402 and f.bloque = 3
24/05/2024 10:37:36 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTDES > '2023-12-01' and f.factoring = 202402 and f.bloque = 3
24/05/2024 10:37:39 - gbenavides - replace into ff_facturas_all_tmp_eliminadas select f.*, 'Importe inferior a 5000' from ff_facturas_all_tmp f where f.IFACTURA < 5000 and f.factoring = 202402 and f.bloque = 3
24/05/2024 10:37:42 - gbenavides - delete from ff_facturas_all_tmp where IFACTURA < 5000 and factoring = 202402 and bloque = 3
24/05/2024 10:37:44 - gbenavides - delete from ff_nif_tmp;
24/05/2024 10:37:44 - gbenavides - replace into ff_nif_tmp select f.CNIFDNIC, f.TIPONEGOCIO, sum(f.IFACTURA) as total from ff_facturas_all_tmp f where f.factoring = 202402 and f.bloque = 3 group by f.CNIFDNIC < 20000
24/05/2024 10:37:45 - gbenavides - delete f from ff_facturas_all_tmp f inner join ff_nif_tmp r on r.CNIFDNIC = f.CNIFDNIC where f.factoring = 202402 and f.bloque = 3
24/05/2024 10:43:55 - gbenavides - delete from ff_facturas_all where factoring = 202312
24/05/2024 10:43:58 - gbenavides - delete from ff_estimacion where factoring = 202312
24/05/2024 10:43:59 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202312 and bloque = 0
24/05/2024 10:44:02 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2022-12-01' and f.fh_fin_fact <= '2022-12-31' and f.fh_fact >='2023-01-01' and f.fh_fact <= '2023-01-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 10:55:59 - gbenavides - replace into ff_facturas_all_tmp select 202312, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2022-12-01' and FFACTHAS <= '2022-12-31') AND (FFACTURA >= '2023-01-01' and FFACTURA <= '2023-01-31') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 10:57:41 - gbenavides - replace into ff_facturas_all_tmp select 202312, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2023-01-01' and FFACTURA <= '2023-01-31') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 10:59:02 - gbenavides - replace into ff_facturas_all_tmp select  202312, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2022-12-01' and f.FFACTURA <= '2022-12-31') and (f.FFACTDES >= '2022-12-01' and f.FFACTHAS <= '2022-12-31') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 10:59:51 - gbenavides - replace into ff_facturas_all_tmp select 202312, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2022-12-01' and FFACTHAS <= '2022-12-31') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 11:02:29 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 11:02:33 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202312 and bloque = 0
24/05/2024 11:02:35 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 20 and INDEMPRE = 'CEFACO' and factoring = 202312 and bloque = 0
24/05/2024 11:02:38 - gbenavides - delete from ff_facturas_all_tmp where ffacthas < '2022-12-01' and factoring = 202312 and bloque = 0
24/05/2024 11:02:39 - gbenavides - update ff_facturas_all_tmp f left outer join fo_s s on s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU left outer join cm_inventario_gas i on i.ID_PS = s.ID_PS and (i.FINICIO <= f.FFACTDES and (i.FFIN >= f.FFACTHAS or i.FFIN is null)) and i.Grupo = 'Cisterna' set f.CUPSREE = concat('Cisterna_', i.ID_PS), f.CCOUNIPS = concat('Cisterna_', i.ID_PS) where f.factoring = 202312 and f.bloque = 0 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 11:03:41 - gbenavides - update ff_facturas_all_tmp f left outer join fo s on s.CEMPTITU = f.CEMPTITU and s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU set f.CUPSREE = s.CUPSREE, f.CCOUNIPS = s.CCOUNIPS where f.factoring = 202312 and f.bloque = 0 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 11:03:42 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 0 and TESTFACT = 'A';
24/05/2024 11:03:43 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 0 and TESTFACT = 'S';
24/05/2024 11:03:46 - gbenavides - delete from ff_facturas_pp_tmp;
24/05/2024 11:03:46 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTHAS < '2022-12-31' and f.factoring = 202312 and f.bloque = 0
24/05/2024 11:03:48 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTDES > '2022-12-01' and f.factoring = 202312 and f.bloque = 0
24/05/2024 11:03:52 - gbenavides - replace into ff_facturas_all_tmp_eliminadas select f.*, 'Importe inferior a 5000' from ff_facturas_all_tmp f where f.IFACTURA < 5000 and f.factoring = 202312 and f.bloque = 0
24/05/2024 11:04:04 - gbenavides - delete from ff_facturas_all_tmp where IFACTURA < 5000 and factoring = 202312 and bloque = 0
24/05/2024 11:04:08 - gbenavides - delete from ff_nif_tmp;
24/05/2024 11:04:09 - gbenavides - replace into ff_nif_tmp select f.CNIFDNIC, f.TIPONEGOCIO, sum(f.IFACTURA) as total from ff_facturas_all_tmp f where f.factoring = 202312 and f.bloque = 0 group by f.CNIFDNIC < 20000
24/05/2024 11:04:11 - gbenavides - delete f from ff_facturas_all_tmp f inner join ff_nif_tmp r on r.CNIFDNIC = f.CNIFDNIC where f.factoring = 202312 and f.bloque = 0
24/05/2024 11:04:35 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202312 and bloque = 1
24/05/2024 11:04:39 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2023-08-01' and f.fh_fin_fact <= '2023-08-31' and f.fh_fact >='2023-09-01' and f.fh_fact <= '2023-09-30' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 11:17:02 - gbenavides - replace into ff_facturas_all_tmp select 202312, 1, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2023-08-01' and FFACTHAS <= '2023-08-31') AND (FFACTURA >= '2023-09-01' and FFACTURA <= '2023-09-30') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 11:18:11 - gbenavides - replace into ff_facturas_all_tmp select 202312, 1, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2023-09-01' and FFACTURA <= '2023-09-30') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 11:18:56 - gbenavides - replace into ff_facturas_all_tmp select  202312, 1, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2023-08-01' and f.FFACTURA <= '2023-08-31') and (f.FFACTDES >= '2023-08-01' and f.FFACTHAS <= '2023-08-31') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 11:19:17 - gbenavides - replace into ff_facturas_all_tmp select 202312, 1, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2023-08-01' and FFACTHAS <= '2023-08-31') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 11:23:09 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 11:23:14 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202312 and bloque = 1
24/05/2024 11:23:16 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 20 and INDEMPRE = 'CEFACO' and factoring = 202312 and bloque = 1
24/05/2024 11:23:19 - gbenavides - delete from ff_facturas_all_tmp where ffacthas < '2023-08-01' and factoring = 202312 and bloque = 1
24/05/2024 11:23:21 - gbenavides - update ff_facturas_all_tmp f left outer join fo_s s on s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU left outer join cm_inventario_gas i on i.ID_PS = s.ID_PS and (i.FINICIO <= f.FFACTDES and (i.FFIN >= f.FFACTHAS or i.FFIN is null)) and i.Grupo = 'Cisterna' set f.CUPSREE = concat('Cisterna_', i.ID_PS), f.CCOUNIPS = concat('Cisterna_', i.ID_PS) where f.factoring = 202312 and f.bloque = 1 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 11:23:57 - gbenavides - update ff_facturas_all_tmp f left outer join fo s on s.CEMPTITU = f.CEMPTITU and s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU set f.CUPSREE = s.CUPSREE, f.CCOUNIPS = s.CCOUNIPS where f.factoring = 202312 and f.bloque = 1 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 11:23:58 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 1 and TESTFACT = 'A';
24/05/2024 11:23:59 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 1 and TESTFACT = 'S';
24/05/2024 11:24:02 - gbenavides - delete from ff_facturas_pp_tmp;
24/05/2024 11:24:03 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTHAS < '2023-08-31' and f.factoring = 202312 and f.bloque = 1
24/05/2024 11:24:04 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTDES > '2023-08-01' and f.factoring = 202312 and f.bloque = 1
24/05/2024 11:24:12 - gbenavides - replace into ff_facturas_all_tmp_eliminadas select f.*, 'Importe inferior a 5000' from ff_facturas_all_tmp f where f.IFACTURA < 5000 and f.factoring = 202312 and f.bloque = 1
24/05/2024 11:24:21 - gbenavides - delete from ff_facturas_all_tmp where IFACTURA < 5000 and factoring = 202312 and bloque = 1
24/05/2024 11:24:26 - gbenavides - delete from ff_nif_tmp;
24/05/2024 11:24:27 - gbenavides - replace into ff_nif_tmp select f.CNIFDNIC, f.TIPONEGOCIO, sum(f.IFACTURA) as total from ff_facturas_all_tmp f where f.factoring = 202312 and f.bloque = 1 group by f.CNIFDNIC < 20000
24/05/2024 11:24:29 - gbenavides - delete f from ff_facturas_all_tmp f inner join ff_nif_tmp r on r.CNIFDNIC = f.CNIFDNIC where f.factoring = 202312 and f.bloque = 1
24/05/2024 11:24:55 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202312 and bloque = 2
24/05/2024 11:25:00 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2023-09-01' and f.fh_fin_fact <= '2023-09-30' and f.fh_fact >='2023-10-01' and f.fh_fact <= '2023-10-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 11:33:49 - gbenavides - replace into ff_facturas_all_tmp select 202312, 2, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2023-09-01' and FFACTHAS <= '2023-09-30') AND (FFACTURA >= '2023-10-01' and FFACTURA <= '2023-10-31') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 11:34:47 - gbenavides - replace into ff_facturas_all_tmp select 202312, 2, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2023-10-01' and FFACTURA <= '2023-10-31') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 11:35:00 - gbenavides - replace into ff_facturas_all_tmp select  202312, 2, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2023-09-01' and f.FFACTURA <= '2023-09-30') and (f.FFACTDES >= '2023-09-01' and f.FFACTHAS <= '2023-09-30') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 11:35:18 - gbenavides - replace into ff_facturas_all_tmp select 202312, 2, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2023-09-01' and FFACTHAS <= '2023-09-30') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 11:38:35 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 11:38:37 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202312 and bloque = 2
24/05/2024 11:38:38 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 20 and INDEMPRE = 'CEFACO' and factoring = 202312 and bloque = 2
24/05/2024 11:38:39 - gbenavides - delete from ff_facturas_all_tmp where ffacthas < '2023-09-01' and factoring = 202312 and bloque = 2
24/05/2024 11:38:40 - gbenavides - update ff_facturas_all_tmp f left outer join fo_s s on s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU left outer join cm_inventario_gas i on i.ID_PS = s.ID_PS and (i.FINICIO <= f.FFACTDES and (i.FFIN >= f.FFACTHAS or i.FFIN is null)) and i.Grupo = 'Cisterna' set f.CUPSREE = concat('Cisterna_', i.ID_PS), f.CCOUNIPS = concat('Cisterna_', i.ID_PS) where f.factoring = 202312 and f.bloque = 2 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 11:39:17 - gbenavides - update ff_facturas_all_tmp f left outer join fo s on s.CEMPTITU = f.CEMPTITU and s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU set f.CUPSREE = s.CUPSREE, f.CCOUNIPS = s.CCOUNIPS where f.factoring = 202312 and f.bloque = 2 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 11:39:18 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 2 and TESTFACT = 'A';
24/05/2024 11:39:19 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 2 and TESTFACT = 'S';
24/05/2024 11:39:20 - gbenavides - delete from ff_facturas_pp_tmp;
24/05/2024 11:39:21 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTHAS < '2023-09-30' and f.factoring = 202312 and f.bloque = 2
24/05/2024 11:39:22 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTDES > '2023-09-01' and f.factoring = 202312 and f.bloque = 2
24/05/2024 11:39:25 - gbenavides - replace into ff_facturas_all_tmp_eliminadas select f.*, 'Importe inferior a 5000' from ff_facturas_all_tmp f where f.IFACTURA < 5000 and f.factoring = 202312 and f.bloque = 2
24/05/2024 11:39:34 - gbenavides - delete from ff_facturas_all_tmp where IFACTURA < 5000 and factoring = 202312 and bloque = 2
24/05/2024 11:39:36 - gbenavides - delete from ff_nif_tmp;
24/05/2024 11:39:37 - gbenavides - replace into ff_nif_tmp select f.CNIFDNIC, f.TIPONEGOCIO, sum(f.IFACTURA) as total from ff_facturas_all_tmp f where f.factoring = 202312 and f.bloque = 2 group by f.CNIFDNIC < 20000
24/05/2024 11:39:38 - gbenavides - delete f from ff_facturas_all_tmp f inner join ff_nif_tmp r on r.CNIFDNIC = f.CNIFDNIC where f.factoring = 202312 and f.bloque = 2
24/05/2024 11:39:55 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202312 and bloque = 3
24/05/2024 11:39:56 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2023-10-01' and f.fh_fin_fact <= '2023-10-31' and f.fh_fact >='2023-11-01' and f.fh_fact <= '2023-11-30' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 11:40:05 - gbenavides - replace into ff_facturas_all_tmp select 202312, 3, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2023-10-01' and FFACTHAS <= '2023-10-31') AND (FFACTURA >= '2023-11-01' and FFACTURA <= '2023-11-30') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 11:40:41 - gbenavides - replace into ff_facturas_all_tmp select 202312, 3, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2023-11-01' and FFACTURA <= '2023-11-30') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 11:40:49 - gbenavides - replace into ff_facturas_all_tmp select  202312, 3, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2023-10-01' and f.FFACTURA <= '2023-10-31') and (f.FFACTDES >= '2023-10-01' and f.FFACTHAS <= '2023-10-31') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 11:41:01 - gbenavides - replace into ff_facturas_all_tmp select 202312, 3, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2023-10-01' and FFACTHAS <= '2023-10-31') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 11:43:56 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 11:44:00 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202312 and bloque = 3
24/05/2024 11:44:03 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 20 and INDEMPRE = 'CEFACO' and factoring = 202312 and bloque = 3
24/05/2024 11:44:08 - gbenavides - delete from ff_facturas_all_tmp where ffacthas < '2023-10-01' and factoring = 202312 and bloque = 3
24/05/2024 11:44:10 - gbenavides - update ff_facturas_all_tmp f left outer join fo_s s on s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU left outer join cm_inventario_gas i on i.ID_PS = s.ID_PS and (i.FINICIO <= f.FFACTDES and (i.FFIN >= f.FFACTHAS or i.FFIN is null)) and i.Grupo = 'Cisterna' set f.CUPSREE = concat('Cisterna_', i.ID_PS), f.CCOUNIPS = concat('Cisterna_', i.ID_PS) where f.factoring = 202312 and f.bloque = 3 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 11:44:22 - gbenavides - update ff_facturas_all_tmp f left outer join fo s on s.CEMPTITU = f.CEMPTITU and s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU set f.CUPSREE = s.CUPSREE, f.CCOUNIPS = s.CCOUNIPS where f.factoring = 202312 and f.bloque = 3 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 11:44:23 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 3 and TESTFACT = 'A';
24/05/2024 11:44:24 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 3 and TESTFACT = 'S';
24/05/2024 11:44:28 - gbenavides - delete from ff_facturas_pp_tmp;
24/05/2024 11:44:28 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTHAS < '2023-10-31' and f.factoring = 202312 and f.bloque = 3
24/05/2024 11:44:29 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTDES > '2023-10-01' and f.factoring = 202312 and f.bloque = 3
24/05/2024 11:44:34 - gbenavides - replace into ff_facturas_all_tmp_eliminadas select f.*, 'Importe inferior a 5000' from ff_facturas_all_tmp f where f.IFACTURA < 5000 and f.factoring = 202312 and f.bloque = 3
24/05/2024 11:44:44 - gbenavides - delete from ff_facturas_all_tmp where IFACTURA < 5000 and factoring = 202312 and bloque = 3
24/05/2024 11:44:54 - gbenavides - delete from ff_nif_tmp;
24/05/2024 11:44:55 - gbenavides - replace into ff_nif_tmp select f.CNIFDNIC, f.TIPONEGOCIO, sum(f.IFACTURA) as total from ff_facturas_all_tmp f where f.factoring = 202312 and f.bloque = 3 group by f.CNIFDNIC < 20000
24/05/2024 11:44:56 - gbenavides - delete f from ff_facturas_all_tmp f inner join ff_nif_tmp r on r.CNIFDNIC = f.CNIFDNIC where f.factoring = 202312 and f.bloque = 3
24/05/2024 13:02:15 - gbenavides - delete from ff_facturas_all where factoring = 202312
24/05/2024 13:02:25 - gbenavides - delete from ff_estimacion where factoring = 202312
24/05/2024 13:02:26 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202312 and bloque = 0
24/05/2024 13:02:30 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2022-12-01' and f.fh_fin_fact <= '2022-12-31' and f.fh_fact >='2023-01-01' and f.fh_fact <= '2023-01-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 13:02:39 - gbenavides - replace into ff_facturas_all_tmp select 202312, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2022-12-01' and FFACTHAS <= '2022-12-31') AND (FFACTURA >= '2023-01-01' and FFACTURA <= '2023-01-31') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 13:03:15 - gbenavides - replace into ff_facturas_all_tmp select 202312, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2023-01-01' and FFACTURA <= '2023-01-31') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 13:03:17 - gbenavides - replace into ff_facturas_all_tmp select  202312, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2022-12-01' and f.FFACTURA <= '2022-12-31') and (f.FFACTDES >= '2022-12-01' and f.FFACTHAS <= '2022-12-31') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 13:03:30 - gbenavides - replace into ff_facturas_all_tmp select 202312, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2022-12-01' and FFACTHAS <= '2022-12-31') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 13:11:29 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 13:11:32 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202312 and bloque = 0
24/05/2024 13:11:33 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 20 and INDEMPRE = 'CEFACO' and factoring = 202312 and bloque = 0
24/05/2024 13:11:34 - gbenavides - delete from ff_facturas_all_tmp where ffacthas < '2022-12-01' and factoring = 202312 and bloque = 0
24/05/2024 13:11:35 - gbenavides - update ff_facturas_all_tmp f left outer join fo_s s on s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU left outer join cm_inventario_gas i on i.ID_PS = s.ID_PS and (i.FINICIO <= f.FFACTDES and (i.FFIN >= f.FFACTHAS or i.FFIN is null)) and i.Grupo = 'Cisterna' set f.CUPSREE = concat('Cisterna_', i.ID_PS), f.CCOUNIPS = concat('Cisterna_', i.ID_PS) where f.factoring = 202312 and f.bloque = 0 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 13:12:47 - gbenavides - update ff_facturas_all_tmp f left outer join fo s on s.CEMPTITU = f.CEMPTITU and s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU set f.CUPSREE = s.CUPSREE, f.CCOUNIPS = s.CCOUNIPS where f.factoring = 202312 and f.bloque = 0 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 13:12:51 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 0 and TESTFACT = 'A';
24/05/2024 13:12:52 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 0 and TESTFACT = 'S';
24/05/2024 13:12:53 - gbenavides - delete from ff_facturas_pp_tmp;
24/05/2024 13:12:53 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTHAS < '2022-12-31' and f.factoring = 202312 and f.bloque = 0
24/05/2024 13:12:55 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTDES > '2022-12-01' and f.factoring = 202312 and f.bloque = 0
24/05/2024 13:12:59 - gbenavides - replace into ff_facturas_all_tmp_eliminadas select f.*, 'Importe inferior a 5000' from ff_facturas_all_tmp f where f.IFACTURA < 5000 and f.factoring = 202312 and f.bloque = 0
24/05/2024 13:13:06 - gbenavides - delete from ff_facturas_all_tmp where IFACTURA < 5000 and factoring = 202312 and bloque = 0
24/05/2024 13:13:08 - gbenavides - delete from ff_nif_tmp;
24/05/2024 13:13:09 - gbenavides - replace into ff_nif_tmp select f.CNIFDNIC, f.TIPONEGOCIO, sum(f.IFACTURA) as total from ff_facturas_all_tmp f where f.factoring = 202312 and f.bloque = 0 group by f.CNIFDNIC < 20000
24/05/2024 13:13:10 - gbenavides - delete f from ff_facturas_all_tmp f inner join ff_nif_tmp r on r.CNIFDNIC = f.CNIFDNIC where f.factoring = 202312 and f.bloque = 0
24/05/2024 13:13:25 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202312 and bloque = 1
24/05/2024 13:13:27 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2023-08-01' and f.fh_fin_fact <= '2023-08-31' and f.fh_fact >='2023-09-01' and f.fh_fact <= '2023-09-30' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 13:13:37 - gbenavides - replace into ff_facturas_all_tmp select 202312, 1, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2023-08-01' and FFACTHAS <= '2023-08-31') AND (FFACTURA >= '2023-09-01' and FFACTURA <= '2023-09-30') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 13:13:59 - gbenavides - replace into ff_facturas_all_tmp select 202312, 1, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2023-09-01' and FFACTURA <= '2023-09-30') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 13:14:03 - gbenavides - replace into ff_facturas_all_tmp select  202312, 1, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2023-08-01' and f.FFACTURA <= '2023-08-31') and (f.FFACTDES >= '2023-08-01' and f.FFACTHAS <= '2023-08-31') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 13:14:08 - gbenavides - replace into ff_facturas_all_tmp select 202312, 1, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2023-08-01' and FFACTHAS <= '2023-08-31') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 13:16:36 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 13:16:37 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202312 and bloque = 1
24/05/2024 13:16:38 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 20 and INDEMPRE = 'CEFACO' and factoring = 202312 and bloque = 1
24/05/2024 13:16:39 - gbenavides - delete from ff_facturas_all_tmp where ffacthas < '2023-08-01' and factoring = 202312 and bloque = 1
24/05/2024 13:16:40 - gbenavides - update ff_facturas_all_tmp f left outer join fo_s s on s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU left outer join cm_inventario_gas i on i.ID_PS = s.ID_PS and (i.FINICIO <= f.FFACTDES and (i.FFIN >= f.FFACTHAS or i.FFIN is null)) and i.Grupo = 'Cisterna' set f.CUPSREE = concat('Cisterna_', i.ID_PS), f.CCOUNIPS = concat('Cisterna_', i.ID_PS) where f.factoring = 202312 and f.bloque = 1 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 13:17:19 - gbenavides - update ff_facturas_all_tmp f left outer join fo s on s.CEMPTITU = f.CEMPTITU and s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU set f.CUPSREE = s.CUPSREE, f.CCOUNIPS = s.CCOUNIPS where f.factoring = 202312 and f.bloque = 1 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 13:17:19 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 1 and TESTFACT = 'A';
24/05/2024 13:17:20 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 1 and TESTFACT = 'S';
24/05/2024 13:17:21 - gbenavides - delete from ff_facturas_pp_tmp;
24/05/2024 13:17:22 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTHAS < '2023-08-31' and f.factoring = 202312 and f.bloque = 1
24/05/2024 13:17:23 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTDES > '2023-08-01' and f.factoring = 202312 and f.bloque = 1
24/05/2024 13:17:29 - gbenavides - replace into ff_facturas_all_tmp_eliminadas select f.*, 'Importe inferior a 5000' from ff_facturas_all_tmp f where f.IFACTURA < 5000 and f.factoring = 202312 and f.bloque = 1
24/05/2024 13:17:35 - gbenavides - delete from ff_facturas_all_tmp where IFACTURA < 5000 and factoring = 202312 and bloque = 1
24/05/2024 13:17:36 - gbenavides - delete from ff_nif_tmp;
24/05/2024 13:17:36 - gbenavides - replace into ff_nif_tmp select f.CNIFDNIC, f.TIPONEGOCIO, sum(f.IFACTURA) as total from ff_facturas_all_tmp f where f.factoring = 202312 and f.bloque = 1 group by f.CNIFDNIC < 20000
24/05/2024 13:17:37 - gbenavides - delete f from ff_facturas_all_tmp f inner join ff_nif_tmp r on r.CNIFDNIC = f.CNIFDNIC where f.factoring = 202312 and f.bloque = 1
24/05/2024 13:17:48 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202312 and bloque = 2
24/05/2024 13:17:49 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2023-09-01' and f.fh_fin_fact <= '2023-09-30' and f.fh_fact >='2023-10-01' and f.fh_fact <= '2023-10-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 13:17:59 - gbenavides - replace into ff_facturas_all_tmp select 202312, 2, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2023-09-01' and FFACTHAS <= '2023-09-30') AND (FFACTURA >= '2023-10-01' and FFACTURA <= '2023-10-31') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 13:18:02 - gbenavides - replace into ff_facturas_all_tmp select 202312, 2, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2023-10-01' and FFACTURA <= '2023-10-31') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 13:18:04 - gbenavides - replace into ff_facturas_all_tmp select  202312, 2, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2023-09-01' and f.FFACTURA <= '2023-09-30') and (f.FFACTDES >= '2023-09-01' and f.FFACTHAS <= '2023-09-30') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 13:18:05 - gbenavides - replace into ff_facturas_all_tmp select 202312, 2, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2023-09-01' and FFACTHAS <= '2023-09-30') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 13:18:16 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 13:18:17 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202312 and bloque = 2
24/05/2024 13:18:18 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 20 and INDEMPRE = 'CEFACO' and factoring = 202312 and bloque = 2
24/05/2024 13:18:19 - gbenavides - delete from ff_facturas_all_tmp where ffacthas < '2023-09-01' and factoring = 202312 and bloque = 2
24/05/2024 13:18:20 - gbenavides - update ff_facturas_all_tmp f left outer join fo_s s on s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU left outer join cm_inventario_gas i on i.ID_PS = s.ID_PS and (i.FINICIO <= f.FFACTDES and (i.FFIN >= f.FFACTHAS or i.FFIN is null)) and i.Grupo = 'Cisterna' set f.CUPSREE = concat('Cisterna_', i.ID_PS), f.CCOUNIPS = concat('Cisterna_', i.ID_PS) where f.factoring = 202312 and f.bloque = 2 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 13:19:02 - gbenavides - update ff_facturas_all_tmp f left outer join fo s on s.CEMPTITU = f.CEMPTITU and s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU set f.CUPSREE = s.CUPSREE, f.CCOUNIPS = s.CCOUNIPS where f.factoring = 202312 and f.bloque = 2 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 13:19:02 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 2 and TESTFACT = 'A';
24/05/2024 13:19:03 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 2 and TESTFACT = 'S';
24/05/2024 13:19:04 - gbenavides - delete from ff_facturas_pp_tmp;
24/05/2024 13:19:05 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTHAS < '2023-09-30' and f.factoring = 202312 and f.bloque = 2
24/05/2024 13:19:06 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTDES > '2023-09-01' and f.factoring = 202312 and f.bloque = 2
24/05/2024 13:19:16 - gbenavides - replace into ff_facturas_all_tmp_eliminadas select f.*, 'Importe inferior a 5000' from ff_facturas_all_tmp f where f.IFACTURA < 5000 and f.factoring = 202312 and f.bloque = 2
24/05/2024 13:19:19 - gbenavides - delete from ff_facturas_all_tmp where IFACTURA < 5000 and factoring = 202312 and bloque = 2
24/05/2024 13:19:21 - gbenavides - delete from ff_nif_tmp;
24/05/2024 13:19:22 - gbenavides - replace into ff_nif_tmp select f.CNIFDNIC, f.TIPONEGOCIO, sum(f.IFACTURA) as total from ff_facturas_all_tmp f where f.factoring = 202312 and f.bloque = 2 group by f.CNIFDNIC < 20000
24/05/2024 13:19:23 - gbenavides - delete f from ff_facturas_all_tmp f inner join ff_nif_tmp r on r.CNIFDNIC = f.CNIFDNIC where f.factoring = 202312 and f.bloque = 2
24/05/2024 13:19:31 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202312 and bloque = 3
24/05/2024 13:19:32 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2023-10-01' and f.fh_fin_fact <= '2023-10-31' and f.fh_fact >='2023-11-01' and f.fh_fact <= '2023-11-30' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 13:19:40 - gbenavides - replace into ff_facturas_all_tmp select 202312, 3, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2023-10-01' and FFACTHAS <= '2023-10-31') AND (FFACTURA >= '2023-11-01' and FFACTURA <= '2023-11-30') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 13:19:43 - gbenavides - replace into ff_facturas_all_tmp select 202312, 3, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2023-11-01' and FFACTURA <= '2023-11-30') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 13:19:44 - gbenavides - replace into ff_facturas_all_tmp select  202312, 3, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2023-10-01' and f.FFACTURA <= '2023-10-31') and (f.FFACTDES >= '2023-10-01' and f.FFACTHAS <= '2023-10-31') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 13:19:46 - gbenavides - replace into ff_facturas_all_tmp select 202312, 3, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2023-10-01' and FFACTHAS <= '2023-10-31') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 13:19:56 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 13:19:57 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202312 and bloque = 3
24/05/2024 13:19:58 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 20 and INDEMPRE = 'CEFACO' and factoring = 202312 and bloque = 3
24/05/2024 13:19:59 - gbenavides - delete from ff_facturas_all_tmp where ffacthas < '2023-10-01' and factoring = 202312 and bloque = 3
24/05/2024 13:20:00 - gbenavides - update ff_facturas_all_tmp f left outer join fo_s s on s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU left outer join cm_inventario_gas i on i.ID_PS = s.ID_PS and (i.FINICIO <= f.FFACTDES and (i.FFIN >= f.FFACTHAS or i.FFIN is null)) and i.Grupo = 'Cisterna' set f.CUPSREE = concat('Cisterna_', i.ID_PS), f.CCOUNIPS = concat('Cisterna_', i.ID_PS) where f.factoring = 202312 and f.bloque = 3 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 13:20:11 - gbenavides - update ff_facturas_all_tmp f left outer join fo s on s.CEMPTITU = f.CEMPTITU and s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU set f.CUPSREE = s.CUPSREE, f.CCOUNIPS = s.CCOUNIPS where f.factoring = 202312 and f.bloque = 3 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 13:20:12 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 3 and TESTFACT = 'A';
24/05/2024 13:20:12 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 3 and TESTFACT = 'S';
24/05/2024 13:20:13 - gbenavides - delete from ff_facturas_pp_tmp;
24/05/2024 13:20:14 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTHAS < '2023-10-31' and f.factoring = 202312 and f.bloque = 3
24/05/2024 13:20:15 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTDES > '2023-10-01' and f.factoring = 202312 and f.bloque = 3
24/05/2024 13:20:18 - gbenavides - replace into ff_facturas_all_tmp_eliminadas select f.*, 'Importe inferior a 5000' from ff_facturas_all_tmp f where f.IFACTURA < 5000 and f.factoring = 202312 and f.bloque = 3
24/05/2024 13:20:19 - gbenavides - delete from ff_facturas_all_tmp where IFACTURA < 5000 and factoring = 202312 and bloque = 3
24/05/2024 13:20:20 - gbenavides - delete from ff_nif_tmp;
24/05/2024 13:20:21 - gbenavides - replace into ff_nif_tmp select f.CNIFDNIC, f.TIPONEGOCIO, sum(f.IFACTURA) as total from ff_facturas_all_tmp f where f.factoring = 202312 and f.bloque = 3 group by f.CNIFDNIC < 20000
24/05/2024 13:20:22 - gbenavides - delete f from ff_facturas_all_tmp f inner join ff_nif_tmp r on r.CNIFDNIC = f.CNIFDNIC where f.factoring = 202312 and f.bloque = 3
24/05/2024 13:37:21 - gbenavides - delete from ff_facturas_all where factoring = 202312
24/05/2024 13:37:23 - gbenavides - delete from ff_estimacion where factoring = 202312
24/05/2024 13:37:23 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202312 and bloque = 0
24/05/2024 13:37:24 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2022-12-01' and f.fh_fin_fact <= '2022-12-31' and f.fh_fact >='2023-01-01' and f.fh_fact <= '2023-01-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 13:43:39 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, null as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact is null and f.fh_fin_fact is null and f.fh_fact >='2023-01-01' and f.fh_fact <= '2023-01-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S' group by ccounips,cemptitu,creferen,secfactu,cfactura,ffactura,ffactdes,ffacthas,ifactura,iva,iimpues2,iimpues3,ibaseise,ise,tfactura,testfact,dapersoc,cnifdnic,indempre,cupsree,cfactrec,clinneg,csegmerc,numlabor,tiponegocio
24/05/2024 13:45:30 - gbenavides - replace into ff_facturas_all_tmp select 202312, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2022-12-01' and FFACTHAS <= '2022-12-31') AND (FFACTURA >= '2023-01-01' and FFACTURA <= '2023-01-31') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 13:45:33 - gbenavides - replace into ff_facturas_all_tmp select 202312, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2023-01-01' and FFACTURA <= '2023-01-31') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 13:45:35 - gbenavides - replace into ff_facturas_all_tmp select  202312, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2022-12-01' and f.FFACTURA <= '2022-12-31') and (f.FFACTDES >= '2022-12-01' and f.FFACTHAS <= '2022-12-31') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 13:45:37 - gbenavides - replace into ff_facturas_all_tmp select 202312, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2022-12-01' and FFACTHAS <= '2022-12-31') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 13:45:47 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 13:45:49 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202312 and bloque = 0
24/05/2024 13:45:49 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 20 and INDEMPRE = 'CEFACO' and factoring = 202312 and bloque = 0
24/05/2024 13:45:51 - gbenavides - delete from ff_facturas_all_tmp where ffacthas < '2022-12-01' and factoring = 202312 and bloque = 0
24/05/2024 13:45:51 - gbenavides - update ff_facturas_all_tmp f left outer join fo_s s on s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU left outer join cm_inventario_gas i on i.ID_PS = s.ID_PS and (i.FINICIO <= f.FFACTDES and (i.FFIN >= f.FFACTHAS or i.FFIN is null)) and i.Grupo = 'Cisterna' set f.CUPSREE = concat('Cisterna_', i.ID_PS), f.CCOUNIPS = concat('Cisterna_', i.ID_PS) where f.factoring = 202312 and f.bloque = 0 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 13:46:52 - gbenavides - update ff_facturas_all_tmp f left outer join fo s on s.CEMPTITU = f.CEMPTITU and s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU set f.CUPSREE = s.CUPSREE, f.CCOUNIPS = s.CCOUNIPS where f.factoring = 202312 and f.bloque = 0 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 13:46:53 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 0 and TESTFACT = 'A';
24/05/2024 13:46:53 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 0 and TESTFACT = 'S';
24/05/2024 13:46:54 - gbenavides - delete from ff_facturas_pp_tmp;
24/05/2024 13:46:55 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTHAS < '2022-12-31' and f.factoring = 202312 and f.bloque = 0
24/05/2024 13:46:56 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTDES > '2022-12-01' and f.factoring = 202312 and f.bloque = 0
24/05/2024 13:47:00 - gbenavides - replace into ff_facturas_all_tmp_eliminadas select f.*, 'Importe inferior a 5000' from ff_facturas_all_tmp f where f.IFACTURA < 5000 and f.factoring = 202312 and f.bloque = 0
24/05/2024 13:47:03 - gbenavides - delete from ff_facturas_all_tmp where IFACTURA < 5000 and factoring = 202312 and bloque = 0
24/05/2024 13:47:04 - gbenavides - delete from ff_nif_tmp;
24/05/2024 13:47:05 - gbenavides - replace into ff_nif_tmp select f.CNIFDNIC, f.TIPONEGOCIO, sum(f.IFACTURA) as total from ff_facturas_all_tmp f where f.factoring = 202312 and f.bloque = 0 group by f.CNIFDNIC < 20000
24/05/2024 13:47:06 - gbenavides - delete f from ff_facturas_all_tmp f inner join ff_nif_tmp r on r.CNIFDNIC = f.CNIFDNIC where f.factoring = 202312 and f.bloque = 0
24/05/2024 13:47:15 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202312 and bloque = 1
24/05/2024 13:47:16 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2023-08-01' and f.fh_fin_fact <= '2023-08-31' and f.fh_fact >='2023-09-01' and f.fh_fact <= '2023-09-30' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 13:57:02 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, null as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact is null and f.fh_fin_fact is null and f.fh_fact >='2023-09-01' and f.fh_fact <= '2023-09-30' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S' group by ccounips,cemptitu,creferen,secfactu,cfactura,ffactura,ffactdes,ffacthas,ifactura,iva,iimpues2,iimpues3,ibaseise,ise,tfactura,testfact,dapersoc,cnifdnic,indempre,cupsree,cfactrec,clinneg,csegmerc,numlabor,tiponegocio
24/05/2024 13:58:41 - gbenavides - replace into ff_facturas_all_tmp select 202312, 1, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2023-08-01' and FFACTHAS <= '2023-08-31') AND (FFACTURA >= '2023-09-01' and FFACTURA <= '2023-09-30') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 13:58:44 - gbenavides - replace into ff_facturas_all_tmp select 202312, 1, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2023-09-01' and FFACTURA <= '2023-09-30') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 13:58:45 - gbenavides - replace into ff_facturas_all_tmp select  202312, 1, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2023-08-01' and f.FFACTURA <= '2023-08-31') and (f.FFACTDES >= '2023-08-01' and f.FFACTHAS <= '2023-08-31') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 13:58:47 - gbenavides - replace into ff_facturas_all_tmp select 202312, 1, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2023-08-01' and FFACTHAS <= '2023-08-31') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 13:58:58 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 13:58:59 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202312 and bloque = 1
24/05/2024 13:58:59 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 20 and INDEMPRE = 'CEFACO' and factoring = 202312 and bloque = 1
24/05/2024 13:59:01 - gbenavides - delete from ff_facturas_all_tmp where ffacthas < '2023-08-01' and factoring = 202312 and bloque = 1
24/05/2024 13:59:01 - gbenavides - update ff_facturas_all_tmp f left outer join fo_s s on s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU left outer join cm_inventario_gas i on i.ID_PS = s.ID_PS and (i.FINICIO <= f.FFACTDES and (i.FFIN >= f.FFACTHAS or i.FFIN is null)) and i.Grupo = 'Cisterna' set f.CUPSREE = concat('Cisterna_', i.ID_PS), f.CCOUNIPS = concat('Cisterna_', i.ID_PS) where f.factoring = 202312 and f.bloque = 1 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 13:59:40 - gbenavides - update ff_facturas_all_tmp f left outer join fo s on s.CEMPTITU = f.CEMPTITU and s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU set f.CUPSREE = s.CUPSREE, f.CCOUNIPS = s.CCOUNIPS where f.factoring = 202312 and f.bloque = 1 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 13:59:40 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 1 and TESTFACT = 'A';
24/05/2024 13:59:41 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 1 and TESTFACT = 'S';
24/05/2024 13:59:42 - gbenavides - delete from ff_facturas_pp_tmp;
24/05/2024 13:59:43 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTHAS < '2023-08-31' and f.factoring = 202312 and f.bloque = 1
24/05/2024 13:59:44 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTDES > '2023-08-01' and f.factoring = 202312 and f.bloque = 1
24/05/2024 13:59:49 - gbenavides - replace into ff_facturas_all_tmp_eliminadas select f.*, 'Importe inferior a 5000' from ff_facturas_all_tmp f where f.IFACTURA < 5000 and f.factoring = 202312 and f.bloque = 1
24/05/2024 13:59:50 - gbenavides - delete from ff_facturas_all_tmp where IFACTURA < 5000 and factoring = 202312 and bloque = 1
24/05/2024 13:59:51 - gbenavides - delete from ff_nif_tmp;
24/05/2024 13:59:52 - gbenavides - replace into ff_nif_tmp select f.CNIFDNIC, f.TIPONEGOCIO, sum(f.IFACTURA) as total from ff_facturas_all_tmp f where f.factoring = 202312 and f.bloque = 1 group by f.CNIFDNIC < 20000
24/05/2024 13:59:53 - gbenavides - delete f from ff_facturas_all_tmp f inner join ff_nif_tmp r on r.CNIFDNIC = f.CNIFDNIC where f.factoring = 202312 and f.bloque = 1
24/05/2024 13:59:59 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202312 and bloque = 2
24/05/2024 14:00:00 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2023-09-01' and f.fh_fin_fact <= '2023-09-30' and f.fh_fact >='2023-10-01' and f.fh_fact <= '2023-10-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 14:00:10 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, null as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact is null and f.fh_fin_fact is null and f.fh_fact >='2023-10-01' and f.fh_fact <= '2023-10-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S' group by ccounips,cemptitu,creferen,secfactu,cfactura,ffactura,ffactdes,ffacthas,ifactura,iva,iimpues2,iimpues3,ibaseise,ise,tfactura,testfact,dapersoc,cnifdnic,indempre,cupsree,cfactrec,clinneg,csegmerc,numlabor,tiponegocio
24/05/2024 14:00:57 - gbenavides - replace into ff_facturas_all_tmp select 202312, 2, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2023-09-01' and FFACTHAS <= '2023-09-30') AND (FFACTURA >= '2023-10-01' and FFACTURA <= '2023-10-31') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 14:01:00 - gbenavides - replace into ff_facturas_all_tmp select 202312, 2, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2023-10-01' and FFACTURA <= '2023-10-31') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 14:01:02 - gbenavides - replace into ff_facturas_all_tmp select  202312, 2, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2023-09-01' and f.FFACTURA <= '2023-09-30') and (f.FFACTDES >= '2023-09-01' and f.FFACTHAS <= '2023-09-30') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 14:01:03 - gbenavides - replace into ff_facturas_all_tmp select 202312, 2, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2023-09-01' and FFACTHAS <= '2023-09-30') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 14:01:14 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 14:01:15 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202312 and bloque = 2
24/05/2024 14:01:15 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 20 and INDEMPRE = 'CEFACO' and factoring = 202312 and bloque = 2
24/05/2024 14:01:17 - gbenavides - delete from ff_facturas_all_tmp where ffacthas < '2023-09-01' and factoring = 202312 and bloque = 2
24/05/2024 14:01:18 - gbenavides - update ff_facturas_all_tmp f left outer join fo_s s on s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU left outer join cm_inventario_gas i on i.ID_PS = s.ID_PS and (i.FINICIO <= f.FFACTDES and (i.FFIN >= f.FFACTHAS or i.FFIN is null)) and i.Grupo = 'Cisterna' set f.CUPSREE = concat('Cisterna_', i.ID_PS), f.CCOUNIPS = concat('Cisterna_', i.ID_PS) where f.factoring = 202312 and f.bloque = 2 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 14:01:59 - gbenavides - update ff_facturas_all_tmp f left outer join fo s on s.CEMPTITU = f.CEMPTITU and s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU set f.CUPSREE = s.CUPSREE, f.CCOUNIPS = s.CCOUNIPS where f.factoring = 202312 and f.bloque = 2 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 14:02:00 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 2 and TESTFACT = 'A';
24/05/2024 14:02:01 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 2 and TESTFACT = 'S';
24/05/2024 14:02:02 - gbenavides - delete from ff_facturas_pp_tmp;
24/05/2024 14:02:03 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTHAS < '2023-09-30' and f.factoring = 202312 and f.bloque = 2
24/05/2024 14:02:04 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTDES > '2023-09-01' and f.factoring = 202312 and f.bloque = 2
24/05/2024 14:02:08 - gbenavides - replace into ff_facturas_all_tmp_eliminadas select f.*, 'Importe inferior a 5000' from ff_facturas_all_tmp f where f.IFACTURA < 5000 and f.factoring = 202312 and f.bloque = 2
24/05/2024 14:02:09 - gbenavides - delete from ff_facturas_all_tmp where IFACTURA < 5000 and factoring = 202312 and bloque = 2
24/05/2024 14:02:10 - gbenavides - delete from ff_nif_tmp;
24/05/2024 14:02:10 - gbenavides - replace into ff_nif_tmp select f.CNIFDNIC, f.TIPONEGOCIO, sum(f.IFACTURA) as total from ff_facturas_all_tmp f where f.factoring = 202312 and f.bloque = 2 group by f.CNIFDNIC < 20000
24/05/2024 14:02:11 - gbenavides - delete f from ff_facturas_all_tmp f inner join ff_nif_tmp r on r.CNIFDNIC = f.CNIFDNIC where f.factoring = 202312 and f.bloque = 2
24/05/2024 14:02:18 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202312 and bloque = 3
24/05/2024 14:02:18 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact >='2023-10-01' and f.fh_fin_fact <= '2023-10-31' and f.fh_fact >='2023-11-01' and f.fh_fact <= '2023-11-30' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
24/05/2024 14:02:27 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, null as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli where f.fh_ini_fact is null and f.fh_fin_fact is null and f.fh_fact >='2023-11-01' and f.fh_fact <= '2023-11-30' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S' group by ccounips,cemptitu,creferen,secfactu,cfactura,ffactura,ffactdes,ffacthas,ifactura,iva,iimpues2,iimpues3,ibaseise,ise,tfactura,testfact,dapersoc,cnifdnic,indempre,cupsree,cfactrec,clinneg,csegmerc,numlabor,tiponegocio
24/05/2024 14:03:54 - gbenavides - replace into ff_facturas_all_tmp select 202312, 3, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2023-10-01' and FFACTHAS <= '2023-10-31') AND (FFACTURA >= '2023-11-01' and FFACTURA <= '2023-11-30') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 14:03:56 - gbenavides - replace into ff_facturas_all_tmp select 202312, 3, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTURA >= '2023-11-01' and FFACTURA <= '2023-11-30') and TFACTURA in (5,6) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 14:03:58 - gbenavides - replace into ff_facturas_all_tmp select  202312, 3, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where (f.FFACTURA >= '2023-10-01' and f.FFACTURA <= '2023-10-31') and (f.FFACTDES >= '2023-10-01' and f.FFACTHAS <= '2023-10-31') and f.TFACTURA in (1,2,5,6) and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t)
24/05/2024 14:04:00 - gbenavides - replace into ff_facturas_all_tmp select 202312, 3, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo f where f.CEMPTITU <> 70 and (FFACTDES >= '2023-10-01' and FFACTHAS <= '2023-10-31') and f.TIPONEGOCIO = 'G' and f.CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
24/05/2024 14:04:10 - gbenavides - update ff_facturas_all_tmp set tfactura = 1 where TIPONEGOCIO = 'G';
24/05/2024 14:04:11 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 70 and factoring = 202312 and bloque = 3
24/05/2024 14:04:12 - gbenavides - delete from ff_facturas_all_tmp where CEMPTITU = 20 and INDEMPRE = 'CEFACO' and factoring = 202312 and bloque = 3
24/05/2024 14:04:14 - gbenavides - delete from ff_facturas_all_tmp where ffacthas < '2023-10-01' and factoring = 202312 and bloque = 3
24/05/2024 14:04:14 - gbenavides - update ff_facturas_all_tmp f left outer join fo_s s on s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU left outer join cm_inventario_gas i on i.ID_PS = s.ID_PS and (i.FINICIO <= f.FFACTDES and (i.FFIN >= f.FFACTHAS or i.FFIN is null)) and i.Grupo = 'Cisterna' set f.CUPSREE = concat('Cisterna_', i.ID_PS), f.CCOUNIPS = concat('Cisterna_', i.ID_PS) where f.factoring = 202312 and f.bloque = 3 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 14:04:25 - gbenavides - update ff_facturas_all_tmp f left outer join fo s on s.CEMPTITU = f.CEMPTITU and s.CREFEREN = f.CREFEREN and s.SECFACTU = f.SECFACTU set f.CUPSREE = s.CUPSREE, f.CCOUNIPS = s.CCOUNIPS where f.factoring = 202312 and f.bloque = 3 and f.TIPONEGOCIO = 'G' and (f.CUPSREE is null or LENGTH(f.CUPSREE) < 20);
24/05/2024 14:04:26 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 3 and TESTFACT = 'A';
24/05/2024 14:04:27 - gbenavides - delete from fact.ff_facturas_all_tmp where factoring = 202312 and bloque = 3 and TESTFACT = 'S';
24/05/2024 14:04:27 - gbenavides - delete from ff_facturas_pp_tmp;
24/05/2024 14:04:28 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTHAS < '2023-10-31' and f.factoring = 202312 and f.bloque = 3
24/05/2024 14:04:29 - gbenavides - select f.factoring, f.bloque, f.CCOUNIPS, f.CEMPTITU, f.CREFEREN, f.SECFACTU, f.CFACTURA, f.FFACTURA, f.FFACTDES, f.FFACTHAS, f.IFACTURA, f.IVA, f.IIMPUES2, f.IIMPUES3, f.IBASEISE, f.ISE, f.TFACTURA, f.TESTFACT, f.DAPERSOC, f.CNIFDNIC, f.INDEMPRE, f.CUPSREE, f.CFACTREC, f.CLINNEG, f.CSEGMERC, f.NUMLABOR, f.TIPONEGOCIO, f.COMENTARIOS from ff_facturas_all_tmp f where f.FFACTDES > '2023-10-01' and f.factoring = 202312 and f.bloque = 3
24/05/2024 14:04:32 - gbenavides - replace into ff_facturas_all_tmp_eliminadas select f.*, 'Importe inferior a 5000' from ff_facturas_all_tmp f where f.IFACTURA < 5000 and f.factoring = 202312 and f.bloque = 3
24/05/2024 14:04:33 - gbenavides - delete from ff_facturas_all_tmp where IFACTURA < 5000 and factoring = 202312 and bloque = 3
24/05/2024 14:04:34 - gbenavides - delete from ff_nif_tmp;
24/05/2024 14:04:35 - gbenavides - replace into ff_nif_tmp select f.CNIFDNIC, f.TIPONEGOCIO, sum(f.IFACTURA) as total from ff_facturas_all_tmp f where f.factoring = 202312 and f.bloque = 3 group by f.CNIFDNIC < 20000
24/05/2024 14:04:36 - gbenavides - delete f from ff_facturas_all_tmp f inner join ff_nif_tmp r on r.CNIFDNIC = f.CNIFDNIC where f.factoring = 202312 and f.bloque = 3
