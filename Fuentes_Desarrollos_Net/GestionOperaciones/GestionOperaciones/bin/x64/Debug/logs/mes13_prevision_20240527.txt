27/05/2024 22:58:46 - gbenavides - delete from ff_facturas_all where factoring = 202312
27/05/2024 22:58:50 - gbenavides - delete from ff_estimacion where factoring = 202312
27/05/2024 22:58:50 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202312 and bloque = 0
27/05/2024 22:58:56 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS,  o.fh_ini_vencimiento as FLIMPAGO, o.fh_puesta_cobro as FPTACOBR  from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli	left join ed_owner.t_ed_h_obligaciones o on f.id_fact = o.cd_fiscal_fact where f.fh_ini_fact >='2022-12-01' and f.fh_fin_fact <= '2022-12-31' and f.fh_fact >='2023-01-01' and f.fh_fact <= '2023-01-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
27/05/2024 22:58:57 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, null as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS, o.fh_ini_vencimiento as FLIMPAGO, o.fh_puesta_cobro as FPTACOBR  from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli	left join ed_owner.t_ed_h_obligaciones o on f.id_fact = o.cd_fiscal_fact where f.fh_ini_fact is null and f.fh_fin_fact is null and f.fh_fact >='2023-01-01' and f.fh_fact <= '2023-01-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S' group by ccounips,cemptitu,creferen,secfactu,cfactura,ffactura,ffactdes,ffacthas,ifactura,iva,iimpues2,iimpues3,ibaseise,ise,tfactura,testfact,dapersoc,cnifdnic,indempre,cupsree,cfactrec,clinneg,csegmerc,numlabor,tiponegocio
27/05/2024 22:58:58 - gbenavides - replace into ff_facturas_all_tmp select 202312, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2022-12-01' and FFACTHAS <= '2022-12-31') AND (FFACTURA >= '2023-01-01' and FFACTURA <= '2023-01-31') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
27/05/2024 23:09:00 - gbenavides - delete from ff_facturas_all where factoring = 202312
27/05/2024 23:09:01 - gbenavides - delete from ff_estimacion where factoring = 202312
27/05/2024 23:09:01 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202312 and bloque = 0
27/05/2024 23:09:06 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS,  o.fh_ini_vencimiento as FLIMPAGO, o.fh_puesta_cobro as FPTACOBR  from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli	left join ed_owner.t_ed_h_obligaciones o on f.id_fact = o.cd_fiscal_fact where f.fh_ini_fact >='2022-12-01' and f.fh_fin_fact <= '2022-12-31' and f.fh_fact >='2023-01-01' and f.fh_fact <= '2023-01-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
27/05/2024 23:09:07 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, null as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS, o.fh_ini_vencimiento as FLIMPAGO, o.fh_puesta_cobro as FPTACOBR  from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli	left join ed_owner.t_ed_h_obligaciones o on f.id_fact = o.cd_fiscal_fact where f.fh_ini_fact is null and f.fh_fin_fact is null and f.fh_fact >='2023-01-01' and f.fh_fact <= '2023-01-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S' group by ccounips,cemptitu,creferen,secfactu,cfactura,ffactura,ffactdes,ffacthas,ifactura,iva,iimpues2,iimpues3,ibaseise,ise,tfactura,testfact,dapersoc,cnifdnic,indempre,cupsree,cfactrec,clinneg,csegmerc,numlabor,tiponegocio
27/05/2024 23:09:08 - gbenavides - replace into ff_facturas_all_tmp select 202312, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2022-12-01' and FFACTHAS <= '2022-12-31') AND (FFACTURA >= '2023-01-01' and FFACTURA <= '2023-01-31') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
27/05/2024 23:11:32 - gbenavides - delete from ff_facturas_all where factoring = 202312
27/05/2024 23:11:32 - gbenavides - delete from ff_estimacion where factoring = 202312
27/05/2024 23:11:32 - gbenavides - delete from ff_facturas_all_tmp where factoring = 202312 and bloque = 0
27/05/2024 23:11:34 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, dc.cd_cups_ext as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS,  o.fh_ini_vencimiento as FLIMPAGO, o.fh_puesta_cobro as FPTACOBR  from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli	left join ed_owner.t_ed_h_obligaciones o on f.id_fact = o.cd_fiscal_fact where f.fh_ini_fact >='2022-12-01' and f.fh_fin_fact <= '2022-12-31' and f.fh_fact >='2023-01-01' and f.fh_fact <= '2023-01-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S'
27/05/2024 23:11:36 - gbenavides - select 'SAP' as CCOUNIPS, case dc.cd_empr when 'ES21' then '20' when 'ES22' then '70' when 'PT1Q' then '80' else '0' end as CEMPTITU, f.cd_di as CREFEREN, 0 as SECFACTU, f.id_fact as CFACTURA, f.fh_fact as FFACTURA, f.fh_ini_fact as FFACTDES, f.fh_fin_fact as FFACTHAS, f.im_factdo_con_iva as IFACTURA, f.nm_total_iva as IVA, f.im_impuesto_2 as IIMPUES2, f.im_impuesto_3 as IIMPUES3, (f.im_factdo_sin_iva - f.im_impto_elect) as IBASEISE, f.im_impto_elect as ISE, case f.cd_tp_fact when 'AG' then '6' when 'SD' then '5' when 'CO' then '1'	when 'MC' then '2' else '1'end as TFACTURA, case f.cd_est_fact when 'A' then 'Y' when 'X' then 'A' else f.cd_est_fact end as TESTFACT, c.tx_apell_cli as DAPERSOC, c.cd_nif_cif_cli as CNIFDNIC, 'OPERACIONES' as INDEMPRE, null as CUPSREE, null as CFACTREC, case dc.cd_linea_negocio when '001' then '1' when '002' then '2' else '1' end as CLINNEG, f.cd_tp_cli as CSEGMERC, 0 as NUMLABOR, case dc.cd_linea_negocio when '001' then 'L' when '002' then 'G' else 'L' end as TIPONEGOCIO, null as COMENTARIOS, o.fh_ini_vencimiento as FLIMPAGO, o.fh_puesta_cobro as FPTACOBR  from ed_owner.t_ed_h_sap_facts f inner join ed_owner.t_ed_h_sap_dc dc on f.cd_di=dc.cd_di inner join ed_owner.t_ed_h_ps ps on ps.cd_cups_ext = dc.cd_cups_ext	left join ed_owner.t_ed_f_clis c on f.cl_cli = c.cl_cli	left join ed_owner.t_ed_h_obligaciones o on f.id_fact = o.cd_fiscal_fact where f.fh_ini_fact is null and f.fh_fin_fact is null and f.fh_fact >='2023-01-01' and f.fh_fact <= '2023-01-31' and f.cl_empr = '006' and ( (dc.cd_empr ='PT1Q' and ps.cd_tp_tension in ('MT','AT','MAT')) or (dc.cd_empr='ES21') ) and ps.lg_migrado_sap ='S' group by ccounips,cemptitu,creferen,secfactu,cfactura,ffactura,ffactdes,ffacthas,ifactura,iva,iimpues2,iimpues3,ibaseise,ise,tfactura,testfact,dapersoc,cnifdnic,indempre,cupsree,cfactrec,clinneg,csegmerc,numlabor,tiponegocio
27/05/2024 23:11:36 - gbenavides - replace into ff_facturas_all_tmp select 202312, 0, CCOUNIPS, CEMPTITU, CREFEREN, SECFACTU, CFACTURA, FFACTURA, FFACTDES, FFACTHAS, IFACTURA, IVA, IIMPUES2, IIMPUES3, IBASEISE, ISE, TFACTURA, TESTFACT, DAPERSOC, CNIFDNIC, INDEMPRE, CUPSREE, CFACTREC, CLINNEG, CSEGMERC, NUMLABOR, TIPONEGOCIO, null from fo where (FFACTDES >= '2022-12-01' and FFACTHAS <= '2022-12-31') AND (FFACTURA >= '2023-01-01' and FFACTURA <= '2023-01-31') and TFACTURA in (1,2) and CFACTURA NOT IN (select t.CFACTURA from ff_facturas_all_tmp t);
